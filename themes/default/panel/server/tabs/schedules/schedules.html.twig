{% block main %}
    <div class="tab-pane" id="schedules">
        <div class="row pt-3">
            <div class="col-12 mb-4">
                {% if serverData.serverSchedules|length == 0 %}
                    <div class="alert alert-info col-6 offset-3" role="alert">
                        <i class="fas fa-info-circle pe-1"></i>
                        {{ 'pteroca.server.no_schedules'|trans }}
                    </div>
                {% else %}
                    <table class="table datagrid text-center">
                        <thead>
                            <tr>
                                <th class="pb-2">{{ 'pteroca.server.schedule_name'|trans }}</th>
                                <th class="pb-2">{{ 'pteroca.server.schedule_cron'|trans }}</th>
                                <th class="pb-2">{{ 'pteroca.server.schedule_status'|trans }}</th>
                                <th class="pb-2">{{ 'pteroca.server.schedule_last_run'|trans }}</th>
                                <th class="pb-2">{{ 'pteroca.server.schedule_next_run'|trans }}</th>
                                <th class="pb-2">{{ 'pteroca.server.actions'|trans }}</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% for schedule in serverData.serverSchedules %}
                            <tr>
                                <td>
                                    <strong>{{ schedule.name }}</strong>
                                </td>
                                <td>
                                    <code class="text-muted">{{ schedule.cron.minute }} {{ schedule.cron.hour }} {{ schedule.cron.day_of_month }} {{ schedule.cron.month }} {{ schedule.cron.day_of_week }}</code>
                                </td>
                                <td>
                                    {% if schedule.is_active %}
                                        <span class="badge bg-success text-white">{{ 'pteroca.server.active'|trans }}</span>
                                    {% else %}
                                        <span class="badge bg-secondary text-white">{{ 'pteroca.server.inactive'|trans }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if schedule.last_run_at %}
                                        {{ schedule.last_run_at|date('Y-m-d H:i:s') }}
                                    {% else %}
                                        <span class="text-muted">{{ 'pteroca.server.never'|trans }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if schedule.next_run_at %}
                                        {{ schedule.next_run_at|date('Y-m-d H:i:s') }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td class="actions actions-as-dropdown text-center">
                                    {% if hasAnyServerPermission(serverData.serverPermissions, ['schedule.update', 'schedule.delete']) %}
                                    <div class="dropdown dropdown-actions">
                                        <a class="dropdown-toggle dropdown-toggle-hidden-marker" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <span class="icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"></path>
                                                </svg>
                                            </span>
                                        </a>
                                        <div class="dropdown-overlay">
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                {% if hasServerPermission(serverData.serverPermissions, 'schedule.update') %}
                                                <li>
                                                    <a class="dropdown-item action-edit" href="#" data-action-name="edit" data-schedule-id="{{ schedule.id }}">
                                                        <span class="action-label">
                                                            <i class="fas fa-edit"></i>
                                                            {{ 'pteroca.server.edit'|trans }}
                                                        </span>
                                                    </a>
                                                </li>
                                                {% endif %}
                                                {% if hasServerPermission(serverData.serverPermissions, 'schedule.delete') %}
                                                <li>
                                                    <a class="dropdown-item action-delete" href="#" data-action-name="delete" data-schedule-id="{{ schedule.id }}">
                                                        <span class="action-label text-danger">
                                                            <i class="fas fa-trash text-danger"></i>
                                                            {{ 'pteroca.server.delete'|trans }}
                                                        </span>
                                                    </a>
                                                </li>
                                                {% endif %}
                                            </ul>
                                        </div>
                                    </div>
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            </div>
            {% if hasServerPermission(serverData.serverPermissions, 'schedule.create') %}
            <div class="col-12 mb-3">
                <button type="button" class="btn btn-primary float-end" onclick="addNewSchedule()">
                    <i class="fas fa-plus"></i>
                    {{ 'pteroca.server.add_schedule'|trans }}
                </button>
            </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block body_javascript %}
    <script>
        let currentSchedules = {{ serverData.serverSchedules|json_encode|raw }};
        
        function addNewSchedule() {
            // TODO: Implementacja dodawania harmonogramu
            alert('{{ 'pteroca.server.feature_coming_soon'|trans }}');
        }
        
        function editSchedule(scheduleId) {
            // TODO: Implementacja edycji harmonogramu
            alert('{{ 'pteroca.server.feature_coming_soon'|trans }}');
        }
        
        function deleteSchedule(scheduleId) {
            // TODO: Implementacja usuwania harmonogramu
            alert('{{ 'pteroca.server.feature_coming_soon'|trans }}');
        }
        
        // Event listenery dla dropdown actions
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('#schedules .dropdown-actions .dropdown-menu .dropdown-item').forEach(function (element) {
                element.addEventListener('click', function (event) {
                    event.preventDefault();

                    const anchorElement = event.target.closest('a');
                    const actionName = anchorElement.getAttribute('data-action-name');
                    const scheduleId = anchorElement.getAttribute('data-schedule-id');

                    if (actionName === 'edit') {
                        editSchedule(scheduleId);
                    } else if (actionName === 'delete') {
                        deleteSchedule(scheduleId);
                    }
                });
            });
        });
    </script>
{% endblock %}
